### FILE xml-rpm-build.file
## NOCOMPILER

%define cmssw_package   %(echo %n | cut -d- -f2,3 | tr '-' '/') 
%define cmssw_subsystem %(echo %cmssw_package | cut -d/ -f1) 
%define BaseTool        %(echo %n | tr '[a-z-]' '[A-Z_]')

%if "%{?dataDir:set}" != "set"
%define dataDir data
%endif

Source: none

%prep
rm -rf %_builddir/%{cmssw_subsystem}
CVS_SERVER=":pserver:anonymous@cmscvs.cern.ch:2401/local/reps/CMSSW.admin"
CVS_PASSWORD="AA_:yZZ3e"
echo "/1 ${CVS_SERVER} ${CVS_PASSWORD}" > ./cvspass
for subdir in %dataDir; do
  CVS_PASSFILE=./cvspass cvs -d ${CVS_SERVER} export -r %realversion %{cmssw_package}/$subdir
done
%{?patchsrc:%patchsrc}
%{?patchsrc2:%patchsrc2}
 
%build

%install
cp -r %_builddir/%{cmssw_subsystem} %i/

%post
echo "%{BaseTool}_ROOT='$CMS_INSTALL_PREFIX/%{pkgrel}'" > $RPM_INSTALL_PREFIX/%{pkgrel}/etc/profile.d/init.sh
echo "set %{BaseTool}_ROOT='$CMS_INSTALL_PREFIX/%{pkgrel}'" > $RPM_INSTALL_PREFIX/%{pkgrel}/etc/profile.d/init.csh
